/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package com.github.catvod.demo;

import java.util.ArrayList;
import java.util.List;

import com.github.catvod.crawler.Spider;
import com.github.catvod.spider.FreeOK;

import org.json.JSONArray;
import org.json.JSONObject;

public class MainActivity {
    public static void main(String[] args) {
        // TX spider = new TX();
        // HOME spider = new HOME();
        FreeOK spider = new FreeOK();
        // 搜索开关，1为true,0为false
        int search_switch = 0;
        if (search_switch == 0) {
            // 搜索,key为空的话，将使用默认值:==>琅琊榜
            test_search(spider, "");
        } else {
            JSONArray res_home = test_home(spider);

            // res_home.getString(0)测试是电视剧还是电影...，可以根据index来切换
            List<String> res_category = test_category(spider, res_home.getString(0));
            // res_category.get(1)测试是那一部视频...，可以根据index来切换
            ArrayList<String> res_detail = test_detail(spider, res_category.get(0));
            test_player(spider, res_detail.get(0));
        }
    }

    public static JSONArray test_home(Spider spider) {
        // 标题栏
        JSONArray res = new JSONArray();
        System.out.println("==========homeContent:=======\n");
        String strhomeContent = spider.homeContent(true);
        if (strhomeContent.equals("")) {
            System.out.println("homeContent返回为空");
            System.exit(0);
        }
        JSONObject result = new JSONObject(new String(strhomeContent));
        try {
            JSONArray classes = result.getJSONArray("class");
            try {
                for (int i = 0; i < classes.length(); i++) {
                    System.out.print(classes.getJSONObject(i).get("type_name") + "["
                            + classes.getJSONObject(i).get("type_id") + "]" + "  ");
                    res.put(classes.getJSONObject(i).get("type_id"));
                }
                System.out.println();
            } catch (Exception e) {
                System.out.println("未读取到type_name或者type_id，请检查！");
            }
        } catch (Exception e) {
            System.out.println("未读取到class，请检查！");
        }
        return res;
    }

    public static List<String> test_category(Spider spider, String tid) {
        System.out.println("\r\n你测试的分类为:" + tid);
        List<String> res = new ArrayList<>();
        // 标题栏下的视频内容
        System.out.println("\r\n==========categoryContent:=======\r\n");
        String strcategoryContent = spider.categoryContent(tid, "1", true, null);
        if (strcategoryContent.equals("")) {
            System.out.println("categoryContent返回为空");
            System.exit(0);
        }
        System.out.println(strcategoryContent);
        System.out.println(tid);
        JSONObject result = new JSONObject(new String(strcategoryContent));
        try {
            int page = result.getInt("page");
            System.out.println("//当前页");
            System.out.println("page:" + page);
        } catch (Exception e) {
            System.out.println("//当前页");
            System.out.println("没有解析到page，请检查！！！");
        }
        try {
            int pagecount = result.getInt("pagecount");
            System.out.println("// 总共几页");
            System.out.println("pagecount:" + pagecount);
        } catch (Exception e) {
            System.out.println("// 总共几页");
            System.out.println("没有解析到pagecount，请检查！！！");
        }
        try {
            int limit = result.getInt("limit");
            System.out.println("// 每页几条数据");
            System.out.println("limit:" + limit);
        } catch (Exception e) {
            System.out.println("// 每页几条数据");
            System.out.println("没有解析到limit，请检查！！！");
        }
        try {
            int total = result.getInt("total");
            System.out.println(" // 总共多少条数据");
            System.out.println("total:" + total);
        } catch (Exception e) {
            System.out.println(" // 总共多少条数据");
            System.out.println("没有解析到total，请检查！！！");
        }
        try {
            JSONArray list = result.getJSONArray("list");
            System.out.println(" //视频列表");
            try {
                for (int i = 0; i < list.length(); i++) {
                    System.out.print(list.getJSONObject(i).get("vod_name") + "["
                            + list.getJSONObject(i).get("vod_id") + "]" + "\r\n");
                    res.add(list.getJSONObject(i).get("vod_id").toString());
                }
            } catch (Exception e) {
                System.out.println("视频列表解析出现问题，请检查!");
            }
        } catch (Exception e) {
            System.out.println(" // 总共多少调数据");
            System.out.println("没有解析到list，请检查！！！");
        }

        return res;

    }

    public static ArrayList<String> test_detail(Spider spider, String ids0) {
        // 视频详细信息,注意List<String> ids只有一个tid
        ArrayList<String> result_url = new ArrayList<String>();
        List<String> ids = new ArrayList<>();
        ids.add(ids0);
        System.out.println("\r\n==========detailContent:=======\r\n");
        System.out.println("你测试的链接是:" + ids0);
        JSONArray data = new JSONArray();
        String strdetailContent = spider.detailContent(ids);
        if (strdetailContent.equals("")) {
            System.out.println("detailContent返回为空");
            System.exit(0);
        }
        JSONObject result = new JSONObject(new String(strdetailContent));
        try {
            JSONArray list = result.getJSONArray("list");
            try {
                String vod_play_from = list.getJSONObject(0).getString("vod_play_from");
                for (String s : vod_play_from.split("\\$\\$\\$")) {
                    JSONObject source = new JSONObject();
                    source.put("source_name", s);
                    data.put(source);
                }
                // System.out.println(data);
            } catch (Exception e) {
                System.out.println("没有解析到vod_play_from,请检查!!!");
            }
            try {
                String vod_play_url = list.getJSONObject(0).getString("vod_play_url");
                int i = 0;
                for (String url_list : vod_play_url.split("\\$\\$\\$")) {
                    JSONArray d = new JSONArray();
                    for (String name_url : url_list.split("\\#")) {
                        JSONArray n_u = new JSONArray();
                        for (String value : name_url.split("\\$")) {
                            n_u.put(value);
                        }

                        d.put(n_u);

                    }
                    data.getJSONObject(i).put("data", d);
                    i = i + 1;

                }

            } catch (Exception e) {
                System.out.println("没有解析到vod_play_url,请检查!!!");
            }
            for (int j = 0; j < data.length(); j++) {
                System.out.println();
                for (int k = 0; k < data.getJSONObject(j).getJSONArray("data").length(); k++) {
                    System.out.println(data.getJSONObject(j).getString("source_name") + "--->"
                            + data.getJSONObject(j).getJSONArray("data").getJSONArray(k).getString(0) + "[ "
                            + data.getJSONObject(j).getJSONArray("data").getJSONArray(k).getString(1) + " ]");
                    result_url.add(data.getJSONObject(j).getJSONArray("data").getJSONArray(k).getString(1));

                }

            }
            return result_url;

            // System.out.println(list);
        } catch (Exception e) {
            System.out.println("未读取到list,请检查!!");
        }

        return null;

    }

    public static String test_player(Spider spider, String url) {
        // 播放内容
        System.out.println("\r\n==========playerContent=======\r\n");
        System.out.println("测试地址为:" + url);
        String strplayerContent = spider.playerContent("", url, null);
        System.out.println(strplayerContent);
        System.exit(0);

        return "";
    }

    public static String test_search(Spider spider, String key) {

        System.out.println("\r\n==========searchContent=======\r\n");
        if (key.equals("")) {
            System.out.println("关键字为空，使用默认值==>琅琊榜\r\n");
            key = "琅琊榜";
        }
        String strsearchContent = spider.searchContent(key, true);
        if (strsearchContent.equals("")) {
            System.out.println("searchContent返回为空");
            System.exit(0);
        }
        JSONObject result = new JSONObject(new String(strsearchContent));
        try {

            JSONArray list = result.getJSONArray("list");
            for (int i = 0; i < list.length(); i++) {
                try {

                    String vod_id = list.getJSONObject(i).getString("vod_id");
                    try {

                        String vod_name = list.getJSONObject(i).getString("vod_name");
                        System.out.println(vod_name + "[" + vod_id + "]");
                    } catch (Exception e) {
                        System.out.println("没有解析到vod_name");
                    }
                } catch (Exception e) {
                    System.out.println("没有解析到vod_id");
                }
            }

        } catch (Exception e) {

            System.out.println("没有解析到list");
        }
        System.exit(0);

        return "";
    }
}
